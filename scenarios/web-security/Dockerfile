FROM debian:12-slim

LABEL maintainer="CTF SENAI" description="CenÃ¡rio Web Security - 3 Desafios"

# Instalar apenas ferramentas essenciais
RUN apt-get update && apt-get install -y --no-install-recommends \
    apache2 php openssh-server curl wget netcat-openbsd file ca-certificates \
    && apt-get clean && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

# SSH config
RUN mkdir -p /var/run/sshd && echo 'root:root' | chpasswd \
    && sed -i 's/#PermitRootLogin prohibit-password/PermitRootLogin yes/' /etc/ssh/sshd_config

# Criar usuÃ¡rio padrÃ£o para terminal
RUN useradd -m -s /bin/bash user && echo 'user:user' | chpasswd

# Criar desafios web
RUN echo -e "User-agent: *\nDisallow: /admin/\nDisallow: /secret/\n\n# Flag: R0B0TS_TXT" > /var/www/html/robots.txt \
    && echo -e '<!DOCTYPE html>\n<html><head><meta charset="UTF-8"><title>CTF SENAI</title></head>\n<body><h1>ðŸŽ¯ CTF SENAI - Web Security</h1>\n<!-- Flag: HTML_C0MM3NT -->\n<p>Explore o site.</p></body></html>' > /var/www/html/index.html \
    && mkdir -p /var/www/html/login \
    && echo -e '<?php\nif(isset($_POST["username"]) && isset($_POST["password"])) {\n    echo "<h2>Flag: SQL_1NJ3CT10N</h2>";\n}\n?>\n<form method="POST">\n<input type="text" name="username" placeholder="Username">\n<input type="password" name="password" placeholder="Password">\n<button type="submit">Login</button>\n</form>' > /var/www/html/login/index.php

# Criar README educativo estilo Bandit
RUN printf '=== CYBERSKILLS LAB - WEB SECURITY ===\n\nBem-vindo aos desafios de SeguranÃ§a Web!\nVocÃª estÃ¡ logado como '\''user'\''. Explore o servidor web.\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n3 DESAFIOS DE SEGURANÃ‡A WEB\n\nComandos Ãºteis:\nâ€¢ curl http://localhost\nâ€¢ curl http://localhost/arquivo\nâ€¢ wget http://localhost\nâ€¢ cat /var/www/html/*\nâ€¢ cat /var/www/html/login/*\nâ€¢ find /var/www -type f\nâ€¢ grep -r "Flag" /var/www\nâ€¢ ls -la /var/www/html\n\nDicas gerais:\n1. Servidores web guardam arquivos em /var/www/html\n2. Arquivos especiais revelam informaÃ§Ãµes\n3. ComentÃ¡rios HTML podem conter dados sensÃ­veis\n4. CÃ³digo fonte de pÃ¡ginas pode ter surpresas\n5. SQL Injection explora queries mal construÃ­das\n6. FormulÃ¡rios podem ser vulnerÃ¡veis\n\nRecursos:\nâ€¢ DiretÃ³rios web: /var/www/html\nâ€¢ Arquivos comuns: robots.txt, index.html, .htaccess\nâ€¢ Scripts PHP: /var/www/html/login\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nðŸ’¡ Usando Google/IA:\n\nâœ… Pergunte: "O que Ã© robots.txt e para que serve?"\nâœ… Pergunte: "Como ver cÃ³digo fonte HTML no terminal?"\nâœ… Pergunte: "O que Ã© SQL Injection bÃ¡sico?"\n\nâŒ NÃ£o peÃ§a: "Me dÃª as flags do desafio web"\n\nAPRENDA seguranÃ§a web, nÃ£o apenas copie!\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nLembre-se: A melhor forma de aprender Ã© tentando sozinho primeiro!\nUse as dicas apenas se estiver realmente travado.\n\nBoa sorte, hacker!\n' > /home/user/README.txt \
    && chown user:user /home/user/README.txt

# Script de inicializaÃ§Ã£o
RUN printf '#!/bin/bash\nservice apache2 start\n/usr/sbin/sshd -D\n' > /start.sh && chmod +x /start.sh

EXPOSE 22 80
CMD ["/start.sh"]
