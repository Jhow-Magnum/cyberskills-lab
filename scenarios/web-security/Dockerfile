FROM debian:12-slim

LABEL maintainer="CTF SENAI" description="CenÃ¡rio Web Security - 3 Desafios"

# Instalar apenas ferramentas essenciais
RUN apt-get update && apt-get install -y --no-install-recommends \
    apache2 php openssh-server curl wget netcat-openbsd file \
    && apt-get clean && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

# SSH config
RUN mkdir -p /var/run/sshd && echo 'root:root' | chpasswd \
    && sed -i 's/#PermitRootLogin prohibit-password/PermitRootLogin yes/' /etc/ssh/sshd_config

# Criar desafios web
RUN echo -e "User-agent: *\nDisallow: /admin/\nDisallow: /secret/\n\n# Flag: R0B0TS_TXT" > /var/www/html/robots.txt \
    && echo -e '<!DOCTYPE html>\n<html><head><meta charset="UTF-8"><title>CTF SENAI</title></head>\n<body><h1>ðŸŽ¯ CTF SENAI - Web Security</h1>\n<!-- Flag: HTML_C0MM3NT -->\n<p>Explore o site.</p></body></html>' > /var/www/html/index.html \
    && mkdir -p /var/www/html/login \
    && echo -e '<?php\nif(isset($_POST["username"]) && isset($_POST["password"])) {\n    echo "<h2>Flag: SQL_1NJ3CT10N</h2>";\n}\n?>\n<form method="POST">\n<input type="text" name="username" placeholder="Username">\n<input type="password" name="password" placeholder="Password">\n<button type="submit">Login</button>\n</form>' > /var/www/html/login/index.php

# Criar README educativo
RUN printf '=== CYBERSKILLS LAB - WEB SECURITY ===\n\nBem-vindo aos desafios de SeguranÃ§a Web!\nVocÃª estÃ¡ logado como '\''user'\'' Explore o servidor web.\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n3 DESAFIOS DE SEGURANÃ‡A WEB\n\nObjetivo: Explorar vulnerabilidades comuns em aplicaÃ§Ãµes web.\n\nComandos essenciais:\nâ€¢ curl http://localhost     - Faz requisiÃ§Ãµes HTTP\nâ€¢ wget http://localhost     - Baixa pÃ¡ginas web\nâ€¢ cat /var/www/html/*       - LÃª arquivos do servidor\nâ€¢ find /var/www -type f     - Busca arquivos web\nâ€¢ grep -r "texto" /var/www - Procura em arquivos\n\nDicas gerais:\n1. Servidores web guardam arquivos em /var/www/html\n2. Arquivos especiais: robots.txt, .htaccess, index.html\n3. ComentÃ¡rios HTML podem conter informaÃ§Ãµes sensÃ­veis\n4. SQL Injection explora queries mal construÃ­das\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nðŸ’¡ Usando Google/IA:\n\nâœ… Pergunte: "O que Ã© robots.txt e para que serve?"\nâœ… Pergunte: "Como ver cÃ³digo fonte HTML no terminal?"\nâœ… Pergunte: "O que Ã© SQL Injection bÃ¡sico?"\n\nâŒ NÃ£o peÃ§a: "Me dÃª as flags do desafio web"\n\nAPRENDA seguranÃ§a web, nÃ£o apenas copie!\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nComece explorando! Digite: curl http://localhost\n' > /home/user/README.txt \
    && chown user:user /home/user/README.txt

# Script de inicializaÃ§Ã£o
RUN printf '#!/bin/bash\nservice apache2 start\n/usr/sbin/sshd -D\n' > /start.sh && chmod +x /start.sh

EXPOSE 22 80
CMD ["/start.sh"]
