FROM debian:12-slim

LABEL maintainer="CTF SENAI" description="CenÃ¡rio Criptografia - 8 Desafios"

# Instalar apenas ferramentas essenciais
RUN apt-get update && apt-get install -y --no-install-recommends \
    openssh-server python3 openssl bc xxd zip unzip file coreutils binutils \
    && apt-get clean && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

# SSH config
RUN mkdir -p /var/run/sshd && echo 'root:root' | chpasswd \
    && sed -i 's/#PermitRootLogin prohibit-password/PermitRootLogin yes/' /etc/ssh/sshd_config

# Criar todos os desafios em uma camada
RUN mkdir -p /opt/challenges/crypto /var/log/ctf /tmp/backup /etc/ctf /home/ctfuser/.secrets /srv/archives \
    && echo "R09SRF9NYXN0ZXJfMjAyNQ==" > /opt/challenges/crypto/message.txt \
    && echo "PVCURE_FVZCYR" > /var/log/ctf/encrypted.log \
    && printf "x0r_s1mpl3" | python3 -c "import sys; data=sys.stdin.buffer.read(); sys.stdout.buffer.write(bytes([b^0x42 for b in data]))" > /tmp/backup/data.enc \
    && echo "482c811da5d5b4bc6d497ffa98491e38" > /etc/ctf/shadow.hash \
    && echo -e "password\npassword123\nadmin\nroot\n123456\nqwerty\nletmein\nwelcome" > /usr/share/dict/common.txt \
    && echo "j43z4y_jy4jr3k" > /home/ctfuser/.secrets/note.txt \
    && mkdir -p /tmp/ziptemp && echo "z1p_r3p41r3d" > /tmp/ziptemp/flag.txt \
    && cd /tmp/ziptemp && zip -q /srv/archives/backup.zip flag.txt \
    && printf '\x00\x00' | dd of=/srv/archives/backup.zip bs=1 count=2 conv=notrunc 2>/dev/null \
    && rm -rf /tmp/ziptemp

# Criar README educativo estilo Bandit
RUN printf '=== CYBERSKILLS LAB - CRIPTOGRAFIA ===\n\nBem-vindo aos desafios de Criptografia!\nVocÃª estÃ¡ logado como '\''root'\''. Explore e decifre.\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n8 DESAFIOS DE CRIPTOGRAFIA\n\nComandos Ãºteis:\nâ€¢ base64 -d\nâ€¢ echo -n "texto" | md5sum\nâ€¢ echo -n "texto" | sha256sum\nâ€¢ sha256sum | cut -c1-8\nâ€¢ tr '\''A-Za-z'\'' '\''N-ZA-Mn-za-m'\''\nâ€¢ tr '\''A-Za-z'\'' '\''H-ZA-Gh-za-g'\''\nâ€¢ xxd arquivo\nâ€¢ xxd -r arquivo\nâ€¢ python3 -c "cÃ³digo"\nâ€¢ for i in {0..255}; do ... done\nâ€¢ while read palavra; do ... done < wordlist\nâ€¢ openssl enc -d\nâ€¢ file arquivo\nâ€¢ unzip arquivo.zip\nâ€¢ printf '\''\\x50\\x4B'\'' | dd of=arquivo\n\nDicas gerais:\n1. Arquivos codificados estÃ£o espalhados pelo sistema\n2. Hashes podem ser quebrados com wordlists\n3. ROT13 Ã© uma cifra de substituiÃ§Ã£o simples\n4. Caesar cipher usa rotaÃ§Ã£o de letras\n5. XOR pode ser quebrado testando todas as chaves (0-255)\n6. Magic numbers identificam tipos de arquivo\n7. ZIP comeÃ§a com bytes 50 4B 03 04\n\nRecursos:\nâ€¢ DiretÃ³rios: /opt, /var/log, /tmp, /etc, /home, /srv\nâ€¢ Wordlists: /usr/share/dict\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nğŸ’¡ Usando Google/IA:\n\nâœ… Pergunte: "Como decodificar Base64 no Linux?"\nâœ… Pergunte: "O que Ã© ROT13 e como decifrar?"\nâœ… Pergunte: "Como quebrar hash MD5 com wordlist?"\n\nâŒ NÃ£o peÃ§a soluÃ§Ãµes prontas!\n\nAPRENDA criptografia, nÃ£o apenas resolva!\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nLembre-se: A melhor forma de aprender Ã© tentando sozinho primeiro!\nUse as dicas apenas se estiver realmente travado.\n\nBoa sorte, hacker!\n' > /root/README.txt

EXPOSE 22
CMD ["/usr/sbin/sshd", "-D"]
