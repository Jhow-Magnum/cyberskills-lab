FROM debian:12-slim

LABEL maintainer="CTF SENAI" description="CenÃ¡rio Linux BÃ¡sico - 14 Desafios"

# Instalar ferramentas minimalistas
RUN apt-get update && apt-get install -y --no-install-recommends \
    openssh-server bash coreutils grep sed gawk findutils less vim procps sudo cron file \
    && apt-get clean && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

# SSH config
RUN mkdir -p /var/run/sshd && echo 'root:root' | chpasswd \
    && sed -i 's/#PermitRootLogin prohibit-password/PermitRootLogin yes/' /etc/ssh/sshd_config

# Criar todos os desafios em uma camada
RUN mkdir -p /root/SENAI /root/scripts/1 /root/.hidden /root/linux /etc/cron.d \
    && echo "pa\$t4" > /root/SENAI/flag \
    && echo -e '#!/bin/bash\necho "==================================="\necho "  Script executado com sucesso!"\necho "==================================="\necho ""\necho "CÃ³digo encontrado: cOdi6o"\necho ""' > /root/scripts/1/script.sh && chmod +x /root/scripts/1/script.sh \
    && echo "echo 'Flag do histÃ³rico: h1st0ry_m4tt3rs'" >> /root/.bash_history \
    && echo "H1DD3N_F1L3" > /root/.hidden/.secret_flag \
    && echo "SU1D_B1N4RY" > /root/linux/suid_flag.txt && chmod 4755 /usr/bin/find \
    && echo -e "# CTF Cron Job\n# Flag: cr0n_m4st3r\n*/5 * * * * root echo 'Cron executado' >> /tmp/cron.log" > /etc/cron.d/ctf-cron && chmod 644 /etc/cron.d/ctf-cron

# Criar README educativo estilo Bandit
RUN printf '=== CYBERSKILLS LAB - LINUX BÃSICO ===\n\nBem-vindo aos desafios de Linux!\nVocÃª estÃ¡ logado como '\''root'\''. Explore o sistema de arquivos.\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n14 DESAFIOS DE COMANDOS LINUX\n\nComandos Ãºteis:\nâ€¢ whoami\nâ€¢ ls, ls -la, ls -R\nâ€¢ cd <diretorio>\nâ€¢ cat <arquivo>\nâ€¢ find / -name <arquivo>\nâ€¢ find / -type f -perm -4000\nâ€¢ grep <texto> <arquivo>\nâ€¢ grep -r "texto" /root\nâ€¢ history\nâ€¢ cat ~/.bash_history\nâ€¢ ps aux\nâ€¢ ps -ef\nâ€¢ chmod +x script.sh\nâ€¢ ./script.sh\nâ€¢ cat /etc/cron.d/*\nâ€¢ crontab -l\n\nDicas gerais:\n1. Arquivos ocultos comeÃ§am com ponto (.)\n2. Use TAB para autocompletar comandos\n3. Explore diretÃ³rios: /root, /home, /etc, /tmp\n4. Scripts executÃ¡veis tÃªm permissÃ£o +x\n5. HistÃ³rico de comandos guarda aÃ§Ãµes anteriores\n6. Processos tÃªm PIDs Ãºnicos\n7. SUID permite executar como outro usuÃ¡rio\n8. Cron jobs sÃ£o tarefas agendadas\n\nRecursos:\nâ€¢ DiretÃ³rios importantes: /root, /etc, /tmp, /var\nâ€¢ Arquivos de configuraÃ§Ã£o: /etc/cron.d\nâ€¢ Scripts: /root/scripts\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nğŸ’¡ Usando Google/IA:\n\nâœ… Pergunte: "Como listar arquivos ocultos no Linux?"\nâœ… Pergunte: "O que faz o comando find?"\nâœ… Pergunte: "Como buscar texto dentro de arquivos?"\n\nâŒ NÃ£o peÃ§a: "Me dÃª a resposta do desafio X"\n\nAPRENDA os comandos, nÃ£o apenas copie!\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nLembre-se: A melhor forma de aprender Ã© tentando sozinho primeiro!\nUse as dicas apenas se estiver realmente travado.\n\nBoa sorte, hacker!\n' > /root/README.txt

EXPOSE 22
CMD ["/usr/sbin/sshd", "-D"]
