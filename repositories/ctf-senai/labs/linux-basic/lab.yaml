apiVersion: ctf.senai.io/v1
kind: Challenge
metadata:
  name: linux-basic
  version: "1.0.0"
  description: "Desafios b√°sicos de Linux para iniciantes em CTF"
  author: "SENAI CyberSec Team"
  difficulty: "easy"
  duration: "60m"
  created: "2024-01-15T10:00:00Z"
  tags:
    - linux
    - bash
    - comandos
    - permiss√µes

spec:
  environment:
    image: ctf-senai/linux-basic:latest
    dockerfile: ../../scenarios/linux-basic/Dockerfile
    resources:
      cpu: "1"
      memory: "512Mi"
    ports:
      - container: 22
        protocol: tcp
        description: "SSH Access"
    credentials:
      user: root
      password: root
    setup_commands:
      - "echo 'Bem-vindo ao desafio Linux B√°sico!' > /etc/motd"
  
  challenges:
    - id: 1
      name: "Primeiro Contato"
      description: "Descubra qual usu√°rio voc√™ √©. Use um comando que mostre sua identidade no sistema."
      category: "recon"
      points: 10
      order: 1
      instructions: |
        Voc√™ acabou de acessar um sistema Linux.
        Sua primeira tarefa √© descobrir qual usu√°rio voc√™ √©.
        
        üí° Dica: Existe um comando que mostra "quem sou eu" (who am i).
      
      hints:
        - text: "O comando come√ßa com 'who'"
          cost: 2
        - text: "Use o comando: whoami"
          cost: 5
      
      validation:
        type: "flag"
        flag: "root"
        flag_format: "text"
        check_command: "whoami"
        expected_output: "root"
      
      solution: |
        Execute o comando:
        $ whoami
        
        A resposta ser√°: root
        Esta √© a flag do desafio 1.
    
    - id: 2
      name: "Pasta SENAI"
      description: "Navegue at√© /root/SENAI e leia o conte√∫do do arquivo 'flag'."
      category: "file-system"
      points: 15
      order: 2
      instructions: |
        Existe uma pasta chamada SENAI no diret√≥rio /root.
        Dentro dela h√° um arquivo chamado 'flag' com a resposta.
        
        üí° Dica: Use comandos de navega√ß√£o e listagem de arquivos.
      
      hints:
        - text: "Use 'ls' para listar arquivos"
          cost: 3
        - text: "Use 'cd /root/SENAI' para entrar na pasta"
          cost: 5
        - text: "Use 'cat flag' para ler o arquivo"
          cost: 8
      
      validation:
        type: "flag"
        flag: "pa$t4"
        flag_format: "text"
        location: "/root/SENAI/flag"
      
      solution: |
        $ cd /root/SENAI
        $ ls
        $ cat flag
        
        A flag √©: pa$t4
    
    - id: 3
      name: "Script Oculto"
      description: "Encontre e execute o script oculto em /root. Arquivos ocultos come√ßam com ponto (.)"
      category: "execution"
      points: 20
      order: 3
      instructions: |
        H√° um script oculto no diret√≥rio /root.
        Arquivos ocultos no Linux come√ßam com ponto (.)
        Encontre-o e execute-o para obter a flag.
      
      hints:
        - text: "Use 'ls -a' para ver arquivos ocultos"
          cost: 5
        - text: "O script se chama .secret.sh"
          cost: 8
        - text: "Execute com: bash .secret.sh"
          cost: 10
      
      validation:
        type: "flag"
        flag: "h1dd3n_scr1pt"
        flag_format: "text"
        location: "/root/.flag3.txt"
      
      solution: |
        $ ls -a
        $ bash .secret.sh
        
        A flag √©: h1dd3n_scr1pt
    
    - id: 4
      name: "Hist√≥rico de Comandos"
      description: "Investigue o hist√≥rico de comandos do bash. A flag est√° registrada l√°."
      category: "forensics"
      points: 15
      order: 4
      instructions: |
        O usu√°rio anterior deixou a flag no hist√≥rico de comandos.
        Investigue o hist√≥rico do bash para encontr√°-la.
      
      hints:
        - text: "O hist√≥rico fica em ~/.bash_history"
          cost: 5
        - text: "Use o comando 'history'"
          cost: 8
      
      validation:
        type: "flag"
        flag: "h1st0ry_m4tt3rs"
        flag_format: "text"
        location: "/root/.bash_history"
      
      solution: |
        $ history
        ou
        $ cat ~/.bash_history
        
        A flag √©: h1st0ry_m4tt3rs
    
    - id: 5
      name: "Processos em Execu√ß√£o"
      description: "Identifique o nome do processo com PID 1. Liste os processos do sistema."
      category: "processes"
      points: 20
      order: 5
      instructions: |
        Todo sistema Linux tem um processo init (PID 1).
        Descubra qual √© o nome do processo com PID 1 neste sistema.
      
      hints:
        - text: "Use 'ps aux' para listar processos"
          cost: 5
        - text: "Use 'ps -p 1' para ver o processo PID 1"
          cost: 8
      
      validation:
        type: "command"
        check_command: "ps -p 1 -o comm="
        expected_output: "systemd"
      
      solution: |
        $ ps -p 1 -o comm=
        
        A resposta √©: systemd
    
    - id: 6
      name: "Arquivo Oculto"
      description: "Conte quantos arquivos ocultos existem em /root. N√£o conte diret√≥rios, apenas arquivos."
      category: "file-system"
      points: 15
      order: 6
      instructions: |
        Quantos arquivos ocultos (come√ßam com .) existem em /root?
        N√£o conte diret√≥rios, apenas arquivos.
      
      hints:
        - text: "Use 'ls -la' para ver todos os arquivos"
          cost: 5
        - text: "Use 'find /root -maxdepth 1 -type f -name \".*\"'"
          cost: 10
      
      validation:
        type: "command"
        check_command: "find /root -maxdepth 1 -type f -name '.*' | wc -l"
        expected_output: "5"
      
      solution: |
        $ find /root -maxdepth 1 -type f -name ".*" | wc -l
        
        A resposta √©: 5
    
    - id: 7
      name: "SUID Binaries"
      description: "Conte quantos bin√°rios com permiss√£o SUID existem em /usr/bin. Use find com -perm."
      category: "permissions"
      points: 25
      order: 7
      instructions: |
        Bin√°rios SUID s√£o executados com privil√©gios do dono.
        Encontre quantos bin√°rios SUID existem em /usr/bin.
      
      hints:
        - text: "SUID tem permiss√£o 4000"
          cost: 8
        - text: "Use: find /usr/bin -perm -4000"
          cost: 12
      
      validation:
        type: "command"
        check_command: "find /usr/bin -perm -4000 2>/dev/null | wc -l"
        expected_output: "3"
      
      solution: |
        $ find /usr/bin -perm -4000 2>/dev/null | wc -l
        
        A resposta √©: 3
    
    - id: 8
      name: "Cron Jobs"
      description: "Liste as tarefas agendadas no crontab do root. A flag est√° l√°."
      category: "system"
      points: 20
      order: 8
      instructions: |
        Existe uma tarefa agendada no crontab do root.
        Descubra qual comando est√° sendo executado.
      
      hints:
        - text: "Use 'crontab -l' para listar tarefas"
          cost: 5
        - text: "Procure em /etc/crontab tamb√©m"
          cost: 10
      
      validation:
        type: "flag"
        flag: "cr0n_m4st3r"
        flag_format: "text"
        location: "/var/spool/cron/crontabs/root"
      
      solution: |
        $ crontab -l
        ou
        $ cat /var/spool/cron/crontabs/root
        
        A flag √©: cr0n_m4st3r
    
    - id: 9
      name: "ACL Espec√≠fica"
      description: "Arquivo acess√≠vel apenas via grupo espec√≠fico"
      category: "permissions"
      points: 25
      order: 9
      instructions: |
        Existe um arquivo em /opt/secure/ que s√≥ pode ser lido pelo grupo 'ctfgroup'.
        Voc√™ precisa se adicionar ao grupo para ler a flag.
      
      hints:
        - text: "Verifique grupos com 'groups' e ACLs com 'getfacl'"
          cost: 8
      
      validation:
        type: "flag"
        flag: "acl_m4st3r"
        location: "/opt/secure/secret.txt"
    
    - id: 10
      name: "PATH Hijacking"
      description: "Bin√°rio falso priorit√°rio no PATH"
      category: "exploitation"
      points: 30
      order: 10
      instructions: |
        Existe um script em /usr/local/bin/check que chama 'ls'.
        Crie um 'ls' falso em /tmp e ajuste o PATH para capturar a flag.
      
      hints:
        - text: "Crie script em /tmp/ls e ajuste PATH=/tmp:$PATH"
          cost: 10
      
      validation:
        type: "flag"
        flag: "p4th_pwn3d"
    
    - id: 11
      name: "Vari√°vel Escondida"
      description: "Flag em vari√°vel de ambiente oculta"
      category: "environment"
      points: 20
      order: 11
      instructions: |
        A flag est√° armazenada em uma vari√°vel de ambiente.
        Use comandos para listar todas as vari√°veis.
      
      hints:
        - text: "Use 'env', 'printenv' ou verifique /proc/self/environ"
          cost: 5
      
      validation:
        type: "flag"
        flag: "3nv_s3cr3t"
    
    - id: 12
      name: "Processo Tempor√°rio"
      description: "Monitore /tmp para capturar flag gerada por cron"
      category: "monitoring"
      points: 30
      order: 12
      instructions: |
        Um processo cron gera um arquivo tempor√°rio em /tmp a cada 30 segundos.
        Monitore o diret√≥rio e capture a flag antes que o arquivo seja deletado.
      
      hints:
        - text: "Use 'watch ls /tmp' ou 'inotifywait' para monitorar"
          cost: 10
      
      validation:
        type: "flag"
        flag: "t3mp_hunt3r"
    
    - id: 13
      name: "Socket Unix"
      description: "Conecte ao socket local para obter flag"
      category: "networking"
      points: 35
      order: 13
      instructions: |
        Um servi√ßo escuta em /var/run/ctf.sock
        Conecte-se ao socket Unix para receber a flag.
      
      hints:
        - text: "Use 'nc -U /var/run/ctf.sock' ou 'socat'"
          cost: 12
      
      validation:
        type: "flag"
        flag: "s0ck3t_m4g1c"
    
    - id: 14
      name: "Strings Ofuscadas"
      description: "Flag fragmentada em bin√°rio"
      category: "reverse-engineering"
      points: 40
      order: 14
      instructions: |
        Existe um bin√°rio em /opt/mystery que cont√©m a flag fragmentada.
        Use ferramentas de an√°lise para extrair e reconstruir a flag.
      
      hints:
        - text: "Use 'strings', 'xxd' ou 'objdump' para analisar o bin√°rio"
          cost: 15
      
      validation:
        type: "flag"
        flag: "b1n_r3v3rs3d"

  scoring:
    total_points: 280
    time_bonus:
      enabled: true
      max_bonus: 20
      calculation: "linear"  # B√¥nus diminui linearmente com o tempo
    
    hint_penalty:
      enabled: true
      deduct_hint_cost: true
    
    completion_bonus:
      enabled: true
      all_challenges: 40
  
  resources:
    - name: "Linux Command Cheat Sheet"
      url: "https://www.linuxtrainingacademy.com/linux-commands-cheat-sheet/"
      type: "external"
    
    - name: "Bash Scripting Guide"
      url: "https://www.gnu.org/software/bash/manual/"
      type: "external"

  prerequisites:
    - "Conhecimento b√°sico de terminal"
    - "Familiaridade com comandos Linux b√°sicos"

  learning_objectives:
    - "Navegar no sistema de arquivos Linux"
    - "Executar comandos b√°sicos do bash"
    - "Entender permiss√µes de arquivos"
    - "Trabalhar com processos"
    - "Investigar hist√≥rico e logs"

  next_challenges:
    - "web-security"
    - "network"
